<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Week 9 â€” Melbourne focus</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    body { margin: 0; font-family: system-ui, Arial; background:#f7fbff; }
    #vis { max-width: 1000px; margin: 24px auto; }
  </style>
</head>
<body>
  <div id="vis"></div>
  <script>
    const spec = {
      $schema: "https://vega.github.io/schema/vega-lite/v5.json",
      width: 960, height: 560,
      background: "#e9f4ff",
      title: { text: "Sample points â€” Melbourne focus", anchor: "start" },

      // ðŸ”Ž Zoom to Melbourne CBD area
      projection: { type: "mercator", center: [144.9631, -37.8136], scale: 12000 },

      layer: [
        // Finer graticule for city scale
        { data: { graticule: { step: [1, 1] } },
          mark: { type: "geoshape", fill: null, stroke: "#c8d0d8" } },

        // Basemap (world countries is fine; we are just zoomed into Melbourne)
        { data: {
            url: "ne_110m_admin_0_countries.topojson",
            format: { type: "topojson", feature: "ne_110m_admin_0_countries" }
          },
          mark: { type: "geoshape", fill: "#fafafa", stroke: "#bdbdbd" } },

        // Your points
        {
          data: { url: "points.csv", format: { type: "csv" } },
          transform: [
            {"calculate": "toNumber(datum.lon)", "as": "lonN"},
            {"calculate": "toNumber(datum.lat)", "as": "latN"},
            {"calculate": "toNumber(datum.value)", "as": "valN"},

            // OPTIONAL: keep only points near Melbourne (rough bbox)
            { "filter": "datum.lonN >= 144.5 && datum.lonN <= 145.5 && datum.latN >= -38.3 && datum.latN <= -37.5" }
          ],
          mark: { type: "circle", opacity: 0.9 },
          encoding: {
            longitude: { field: "lonN", type: "quantitative" },
            latitude:  { field: "latN", type: "quantitative" },
            color:     { field: "valN", type: "quantitative", title: "Value" },
            size:      { field: "valN", type: "quantitative", scale: { range: [20, 300] } },
            tooltip:   [{ field: "name", title: "Place" }, { field: "valN", title: "Value" }]
          }
        }
      ],

      config: { view: { stroke: null }, legend: { titleFontSize: 12, labelFontSize: 11 } }
    };

    vegaEmbed("#vis", spec, { actions: false });
  </script>
</body>
</html>
