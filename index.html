<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Week 9 — Travel Modes (toggle)</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    body { margin: 0; font-family: system-ui, Arial; background:#f7fbff; }
    #vis { max-width: 1000px; margin: 24px auto; }
  </style>
</head>
<body>
  <div id="vis"></div>
  <script>
    const spec = {
      $schema: "https://vega.github.io/schema/vega-lite/v5.json",
      width: 960, height: 520,
      background: "#e9f4ff",
      title: { text: "Share of trips by mode — toggle", anchor: "start" },

      projection: { type: "mercator", center: [134, -25], scale: 900 },

      params: [{
        name: "metricSel",
        value: "Public transport",
        bind: { input: "select", options: ["Public transport", "Car", "Active"], name: "Metric: " }
      }],

      layer: [
        { data: { graticule: { step: [20, 20] } },
          mark: { type: "geoshape", fill: null, stroke: "#c8d0d8" } },

        { data: {
            url: "ne_110m_admin_0_countries.topojson",
            format: { type: "topojson", feature: "ne_110m_admin_0_countries" }
          },
          mark: { type: "geoshape", fill: "#fafafa", stroke: "#bdbdbd" } },

        {
          data: { url: "points.csv", format: {type: "csv"} },
          transform: [
            {"calculate": "toNumber(datum.lon)",   "as": "lonN"},
            {"calculate": "toNumber(datum.lat)",   "as": "latN"},
            {"calculate": "toNumber(datum.value)", "as": "valN"},
            { "filter": { "field": "metric", "equal": {"expr": "metricSel"} } }
          ],
          mark: { type: "circle", opacity: 0.9 },
          encoding: {
            longitude: { field: "lonN", type: "quantitative" },
            latitude:  { field: "latN", type: "quantitative" },
            color:     { field: "valN", type: "quantitative",
                         title: { expr: "metricSel + ' (%)'" } },
            size:      { field: "valN", type: "quantitative",
                         scale: { range: [40, 800] } },
            tooltip: [
              { field: "name",   title: "Suburb/Region" },
              { field: "metric", title: "Metric" },
              { field: "valN",   title: "Value (%)", format: ".1f" }
            ]
          }
        }
      ],

      config: { view: { stroke: null }, legend: { titleFontSize: 12, labelFontSize: 11 } }
    };

    vegaEmbed("#vis", spec, { actions: false });
  </script>
</body>
</html>
